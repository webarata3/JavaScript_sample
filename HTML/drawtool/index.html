<!DOCTYPE html>
<html lang="ja">
 <head>
  <meta charset="utf-8">
  <title>お絵かき</title>
  <style>
   canvas {
    border: 1px solid #999;
   }

  </style>
 </head>
 <body>
  <!-- canvasは、widthとheight属性でサイズを指定しないときちんと動かない -->
  <canvas width="500" height="500"></canvas>
  <button>画像のダウンロード</button>
  <script>
   'use strict';

   let dragging = false;
   let beforeX = null;
   let beforeY = null;
   const canvas = document.querySelector('canvas');
   const ctx = canvas.getContext('2d');
   canvas.addEventListener('mousedown', event => {
    dragging = true;
    changeCoordinate(event.offsetX, event.offsetY);
   });
   canvas.addEventListener('mouseup', event => {
    dragging = false;
    removeCoordinate();
   });
   canvas.addEventListener('mousemove', event => {
    if (!dragging) return;
    ctx.lineWidth = 10;
    ctx.lineCap = 'round';
    ctx.beginPath();
    ctx.moveTo(beforeX, beforeY);
    ctx.lineTo(event.offsetX, event.offsetY);
    ctx.stroke();
    changeCoordinate(event.offsetX, event.offsetY);
   });
   function changeCoordinate(x, y) {
    [beforeX, beforeY] = [x, y];
   }
   function removeCoordinate() {
    changeCoordinate(null, null);
   }

   document.querySelector('button').addEventListener('click', () => {
    const downloadLink = document.createElement('a');
    downloadLink.href = canvas.toDataURL('image/png');
    downloadLink.download = 'image.png';
    downloadLink.click();
    downloadLink.remove();
   });
  </script>
 </body>
</html>
